---
title: "Env_val"
author: "Sarah Klain"
date: "March 6, 2016"
output: 
  html_document: 
    keep_md: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
![alt text](Pandora8.jpg)

#### Setup

```{r}
library(Hmisc) #to run correlations with sig levels
# library(ggplot2) # for great charts
# library(ggthemes) # for pretty themes in ggplot
# library(viridis) # for pretty colors
# suppressMessages(library(dplyr))
library(knitr) # tool for making nice tables
# library(tidyr) # data table wrangling tool
# library(broom)
# library(stargazer) # mekes pretty tables
library(stats) # for PCA & FA
library(psych) # for PCA
library(devtools ) # for nice plots of PCAs
# install_github("ggbiplot", "vqv")
library(ggbiplot)
#library(dplyr)
```

#### Input data
```{r}
setwd("/Users/sarahklain/Documents/R_2015/navi") #set working directory
#ev <- read.csv("Env_Val_02_29_2016.csv")

ev <- read.csv("ev_mt_f_t_no_R.csv")
ev1 <- (ev[3:11])

ev_mt <- read.csv("ev_mt.csv")
```

### Cronbach's alpha
```{r}
# Apply to relational and NEP variables
alpha(ev1, check.keys=TRUE)

# Apply to NEP variables
nep <- read.csv("nep.csv")
alpha(nep)

mt_nep <- (ev_mt[3:7]) # only NEP values
# alpha(mt_nep)
alpha(mt_nep, check.keys=TRUE)

mt_val <- (mt[3:21]) # includes all value prompts
str(mt_val)
alpha(mt_val, check.keys = TRUE)
```

### Correlation Matrix

```{r}
# corr1 <- rcorr(mt_val, type = "pearson")
# corr1
```

### PCA

```{r}
fit_ev_mt <- prcomp(~ ., data=mt_val, na.action=na.omit, scale=TRUE)

summary(fit_ev_mt) # print variance accounted for 
loadings(fit_ev_mt) # pc loadings 
plot(fit_ev_mt,type="lines") # scree plot 
fit_ev_mt$scores # the principal components
biplot(fit_ev_mt)
# what is this?
# how do I account for demographic features?
```

```{r}
# data from mt, t and f

fit_ev <- prcomp(~ ., data = ev1, na.action = na.omit, scale=TRUE)

summary(fit_ev) # print variance accounted for 
loadings(fit_ev) # pc loadings 
plot(fit_ev,type="lines") # scree plot 
fit_ev$scores # the principal components
biplot(fit_ev)


g <- ggbiplot(fit_ev, obs.scale = 1, var.scale = 1, 
              ellipse = TRUE, 
              circle = TRUE)
g <- g + scale_color_discrete(name = '')
g <- g + theme(legend.direction = 'horizontal', 
               legend.position = 'top')
print(g)
```

# next steps: Factor Analysis
```
 
 ### Factor Analysis

 # factanal(x, factors, data = NULL, covmat = NULL, n.obs = NA,
 #        subset, na.action, start = NULL,
 #        scores = c("none", "regression", "Bartlett"),
 #        rotation = "varimax", control = NULL, ...)
 
 ## M-Turk Data
```{r}
fit_mt <- factanal(~ ., factors = 7, data = mt_val)
print(fit_mt, digits=2, cutoff=.3, sort=TRUE)
# plot factor 1 by factor 2 
load <- fit_mt$loadings[,1:2] 
plot(load,type="n") # set up plot 
text(load,labels=names(mt_val),cex=.7) # add variable names
```

```{r}
fit_mt <- factanal(~ ., factors = 5, data = mt_val)
print(fit_mt, digits=2, cutoff=.3, sort=TRUE)
# plot factor 1 by factor 2 
load <- fit_mt$loadings[,1:2] 
plot(load,type="n") # set up plot 
text(load,labels=names(mt_val),cex=.7) # add variable names
```

```{r}
fit_mt <- factanal(~ ., factors = 4, data = mt_val)
print(fit_mt, digits=2, cutoff=.3, sort=TRUE)
# plot factor 1 by factor 2 
load <- fit_mt$loadings[,1:2] 
plot(load,type="n") # set up plot 
text(load,labels=names(mt_val),cex=.7) # add variable names
```

```{r}
fit_mt <- factanal(~ ., factors = 3, data = mt_val)
print(fit_mt, digits=2, cutoff=.3, sort=TRUE)
# plot factor 1 by factor 2 
load <- fit_mt$loadings[,1:2] 
plot(load,type="n") # set up plot 
text(load,labels=names(mt_val),cex=.7) # add variable names
```

```{r}
fit_mt <- factanal(~ ., factors = 2, data = mt_val)
print(fit_mt, digits=2, cutoff=.3, sort=TRUE)
# plot factor 1 by factor 2 
load <- fit_mt$loadings[,1:2] 
plot(load,type="n") # set up plot 
text(load,labels=names(mt_val),cex=.7) # add variable names
```

```{r}
fit_ev <- factanal(~ ., factors = 3, data = ev1)
print(fit_ev, digits=2, cutoff=.3, sort=TRUE)
# plot factor 1 by factor 2 
load <- fit_ev$loadings[,1:2] 
plot(load,type="n") # set up plot 
text(load,labels=names(ev1),cex=.7) # add variable names
```

## All 3 Samples Pooled
```{r}
fit_ev <- factanal(~ ., factors = 4, data = ev1)
print(fit_ev, digits=2, cutoff=.3, sort=TRUE)
# plot factor 1 by factor 2 
load <- fit_ev$loadings[,1:2] 
plot(load,type="n") # set up plot 
text(load,labels=names(ev1),cex=.7) # add variable names
```


