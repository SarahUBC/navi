---
title: "Env_val"
author: "Sarah Klain"
date: "March 6, 2016"
output: 
  html_document: 
    keep_md: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
![alt text](Pandora8.jpg)

#### Setup

```{r}
library(Hmisc) #to run correlations with sig levels
library(ggplot2) # for great charts
library(ggthemes) # for pretty themes in ggplot
library(viridis) # for pretty colors
suppressMessages(library(dplyr))
library(knitr) # tool for making nice tables
library(tidyr) # data table wrangling tool
library(broom)
library(stargazer) # mekes pretty tables
library(stats) # for PCA & FA
library(psych) # for PCA
```

#### Input data
```{r}
setwd("/Users/sarahklain/Documents/R_2015/navi") #set working directory
ev <- read.csv("Env_Val_02_29_2016.csv")
```

### Cronbach's alpha
```{r}
# Apply to NEP scores
nep <- read.csv("nep.csv")
alpha(nep)

# Apply to M-Turk, all variables
mt <- read.csv("env_val_MT.csv")
alpha(mt)
# alpha(met[3:7])

mt_nep <- (mt[3:7]) # only NEP values
# alpha(mt_nep)
alpha(mt_nep, check.keys=TRUE)

mt_val <- (mt[3:21]) # includes all value prompts
str(mt_val)
alpha(mt_val, check.keys = TRUE)
```

### Correlation Matrix

```{r}
# corr1 <- rcorr(mt_val, type = "pearson")
# corr1
```

### PCA

```{r}
fit <- prcomp(~ ., data=mt_val, na.action=na.omit, scale=TRUE)

summary(fit) # print variance accounted for 
loadings(fit) # pc loadings 
plot(fit,type="lines") # scree plot 
fit$scores # the principal components
biplot(fit)
# what is this?
# how do I account for demographic features?
# next steps: Factor Analysis
```
 
 ### Factor Analysis

 # factanal(x, factors, data = NULL, covmat = NULL, n.obs = NA,
 #        subset, na.action, start = NULL,
 #        scores = c("none", "regression", "Bartlett"),
 #        rotation = "varimax", control = NULL, ...)
 

```{r}
fit_mt <- factanal(~ ., factors = 5, data = mt_val)
print(fit_mt, digits=2, cutoff=.3, sort=TRUE)
# plot factor 1 by factor 2 
load <- fit_mt$loadings[,1:2] 
plot(load,type="n") # set up plot 
text(load,labels=names(mt_val),cex=.7) # add variable names
```

